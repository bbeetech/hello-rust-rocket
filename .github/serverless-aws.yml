name: Deploy to AWS Lambda

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

steps:
  - name: Checkout code
    uses: actions/checkout@v2

  - name: Login to AWS ECR
    uses: aws-actions/amazon-ecr-login@v1

  - name: Build Docker image
    uses: docker/build-push-action@v2
    with:
      context: .
      push: true
      tags: app-service:latest

  - name: serverless deploy
    uses: serverless/github-action@v3.2
    with:
      args: deploy
    env:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
